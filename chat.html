<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/bootstrap.min.css.map" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!-- fav icon -->
    <link rel="icon" type="image/png" href="imgs/mainlogo.png" />

    <link rel="stylesheet" href="css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/jquery.fancybox.min.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/dark.css" />

    <title>Chat</title>
  </head>

  <body>
    <div class="nav-layer"></div>

    <!-- ************** start page  loader ************** -->
    <div class="loader-container">
      <span class="loader"></span>
    </div>
    <!-- ************** end loader ************** -->
    <!--start header-->
    <header class="header">
      <div class="container">
        <a href="index.html" class="logo"
          ><img src="imgs/mainlogo.png" alt="img"
        /></a>
        <ul class="links">
          <div class="flex-group-me mid-screen">
            <img src="imgs/mainlogo.png" class="logo mid-screen" alt="" />
          </div>
          <li><a href="index.html">الرئيسية</a></li>
          <li><a href="index.html#categories">الاقسام</a></li>
          <li><a href="faqs.html">الاسئلة الشائعة</a></li>
          <li><a href="contact-us.html">تواصل معنا</a></li>
        </ul>

        <div class="flex-sm-gap">
          <!-- messages shown if user is logged -->
          <a href="chats.html" class="container-btn-main">
            <div class="text">الرسائل</div>
            <div class="icon-cont">
              <span>5</span>
              <i class="fa-regular fa-message"></i>
            </div>
          </a>
          <!-- notification shown if user is logged -->
          <a href="notifications.html" class="container-btn-main">
            <div class="text">الاشعارات</div>
            <div class="icon-cont">
              <span>5</span>
              <i class="fa-regular fa-bell"></i>
            </div>
          </a>
          <!-- coins count shown if user is logged -->
          <a href="coins.html" class="container-btn-main">
            <div class="text">عدد الكوينز</div>
            <div class="icon-cont-coins color-main font-bold">3242</div>
          </a>

          <!-- lang shown if user is Not logged -->

          <!-- <a href="#">English</a> -->

          <!-- login button shown if user is Not logged -->

          <!-- <a href="#" data-bs-toggle="modal" data-bs-target="#login-modal" class="main-btn light up btn-login"><span class="text">دخول</span> <img
            class="img-log" src="imgs/2 User.png" alt="img"></a> -->

          <!-- profile dropdown shown if user is logged  -->
          <div class="profile-btn">
            <img src="imgs/Vector (15).png" alt="img" />

            <div class="flex-dbl-sm ltr">
              <img src="imgs/user.jpg" class="profile-img-head" alt="img" />
              <div class="big-screen">
                <div class="name-of-profile">عبدالرحمن</div>
              </div>
            </div>
            <ul class="dropProfile p-2">
              <div class="flex-group-me mb-2 mt-2">
                <img src="imgs/user.jpg" class="profile-img-head" alt="img" />
              </div>
              <div class="flex-group-me font14 mb-3">
                <div>24242</div>
                <img
                  style="max-width: 22px"
                  src="imgs/twemoji_coin.png"
                  alt="img"
                />
              </div>

              <div class="all-lis mt-4 mb-3">
                <a href="profile.html" class="flex-dbl-sm mb-2">
                  <i class="fa-regular fa-user"></i>
                  <div class="gray-col">الملف الشخصي</div>
                </a>
                <a href="saved.html" class="flex-dbl-sm mb-2">
                  <i class="fa-solid fa-bookmark"></i>
                  <div class="gray-col">المحفوظات</div>
                </a>
                <a href="wallet.html" class="flex-dbl-sm mb-2">
                  <i class="fa-solid fa-wallet"></i>
                  <div class="gray-col">المحفظة</div>
                </a>
                <div class="flex-dbl-sm">
                  <img src="imgs/Icons.png" alt="img" />
                  <div class="gray-col">English</div>
                </div>
              </div>

              <div class="flex-group-me">
                <div class="all-nights">
                  <label for="light" class="mode-label">
                    <input type="radio" checked hidden name="mode" id="light" />
                    <div class="text">الوضع الفاتح</div>
                    <i class="fa-solid fa-sun"></i>
                  </label>
                  <label for="dark" class="mode-label">
                    <input type="radio" hidden name="mode" id="dark" />
                    <div class="text">الوضع الليلي</div>
                    <i class="fa-solid fa-moon"></i>
                  </label>
                </div>
              </div>
              <div class="px-1 mt-3 mb-3">
                <a href="" class="main-btn w-100 red-bg">تسجيل الخروج</a>
              </div>
            </ul>
          </div>

          <!-- shown every time -->
          <span class="coll-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </div>
      </div>
    </header>
    <!--end header-->

    <!--start Home-->
    <div class="home-section">
      <div class="container mt-4 mb-4 pb-3">
        <h6 class="mt-4 mb-4 font20">تفاصيل المحادثة</h6>
        <div class="h-main">
          <div class="col-lg-10 col-12 margin-auto">
            <div class="chat-body p-0">
              <div class="chat-header">
                <!-- edited -->
                <div class="flex-sm-gap align-items-center">
                  <img src="imgs/user.jpg" class="user-main-img" alt="img" />

                  <div class="right-h">
                    <h6 class="mb-2">عبدالرحمن سليمان</h6>
                    <p class="gray-col font12 mb-0">
                      يمكنك مراسلة عبدالرحمن سليمان من هنا
                    </p>
                  </div>
                </div>
              </div>
              <div class="chat-messages">
                <div class="message-single mb-3 sender">
                  <img src="imgs/user.jpg" class="chat-user" alt="" />
                  <div class="message-contain">
                    <div class="message-text regular mb-1 font12">
                      نص تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي .. نص
                      تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي ..
                    </div>
                    <div class="font12 message-time">
                      16.50 am
                      <!-- <span><i class="fa-solid fa-check"></i></span> -->
                      <i class="fa-solid fa-check-double color-main"></i>
                    </div>
                    <!-- edited -->
                  </div>
                </div>
                <div
                  class="message-single mb-3 sender voice-message"
                  data-index="0"
                  data-src="imgs/elneqm.mp3"
                >
                  <img src="imgs/user.jpg" class="chat-user" alt="" />
                  <div class="message-contain fit-width p-2">
                    <div class="voice-note-container">
                      <div class="play-button" id="playPauseBtn0">
                        <i class="fas fa-play"></i>
                      </div>
                      <div id="waveformEach0"></div>
                      <div id="current-time0" class="gray-col font10 time-main">
                        0:00
                      </div>
                    </div>
                    <div class="font12 message-time">
                      16.50 am
                      <i class="fa-solid fa-check-double color-main"></i>
                    </div>
                  </div>
                </div>
                <div class="message-single mb-3 reciever">
                  <img src="imgs/user.jpg" class="chat-user" alt="" />
                  <div class="message-contain">
                    <div class="message-text regular mb-1 font12">
                      نص تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي .. نص
                      تجريبي .. نص تجريبي .. نص تجريبي .. نص تجريبي ..
                    </div>
                    <div class="font12">16.50</div>
                  </div>
                </div>

                <!-- <div id="waveform0"></div> -->
              </div>
              <div class="chat-senders">
                <label class="mb-0 label-chat voice-main">
                  <i class="fa-solid fa-microphone"></i>
                </label>
                <div class="flex-sm-gap voice-m">
                  <div class="loader-chat">
                    <div class="bar bar1"></div>
                    <div class="bar bar2"></div>
                    <div class="bar bar3"></div>
                    <div class="bar bar4"></div>
                    <div class="bar bar5 mob-none"></div>
                    <div class="bar bar6 mob-none"></div>
                    <div class="bar bar7 mob-none"></div>
                    <div class="bar bar8 mob-none"></div>
                  </div>
                  <button
                    type="button"
                    class="up stop-record radious-div bg-danger"
                  >
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                </div>
                <!-- <input type="text" class="main-input input-chat-m" placeholder="اكتب رسالتك هنا" /> -->
                <textarea
                  name=""
                  id=""
                  oninput="textareaWhrite()"
                  class="main-textarea input-chat-m"
                  placeholder="اكتب رسالتك هنا"
                ></textarea>
                <label class="mb-0 files-up" for="filesNext_input-def">
                  <input
                    type="file"
                    multiple
                    hidden
                    id="filesNext_input"
                    class="heddenUploud files-input files-upload-chat"
                    name="filesNext[]"
                    data-input="filesNext"
                    value=""
                  />
                  <i
                    class="fa-solid fa-paperclip"
                    onclick="handleUpload('file')"
                  ></i>
                  <i
                    class="fa-regular fa-file-image"
                    onclick="handleUpload('image')"
                  ></i>
                </label>

                <button class="un-styled-btn main-btn send-message">
                  ارسال
                  <i class="fa-solid fa-paper-plane"></i>
                </button>
              </div>
              <div
                class="uploaded__area area-uploaded"
                id="filesNext_cont"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--end Home-->

    <!--start footer-->
    <div class="footer">
      <div class="main-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-3 col-md-6 col-12">
              <div class="footer-colomn-me">
                <div
                  class="foot-lo d-flex align-items-center justify-content-center mb-4"
                >
                  <img src="imgs/footerlogo.png" alt="img" />
                </div>

                <ul>
                  <a href="tel:010029787" class="flex-dbl-sm mb-4">
                    <i class="fa-solid fa-phone color-white"></i>
                    <div class="d-text-footer">010029787</div>
                  </a>
                  <a href="mailto:solia@yahoo.com" class="flex-dbl-sm mb-4">
                    <i class="fa-solid fa-envelope color-white"></i>

                    <div class="d-text-footer">solia@yahoo.com</div>
                  </a>
                </ul>

                <div class="flex-group-me gap-m">
                  <a href="#">
                    <img src="imgs/foot.png" class="social-img" alt="img" />
                  </a>
                  <a href="#">
                    <img src="imgs/foot.png" class="social-img" alt="img" />
                  </a>
                  <a href="#">
                    <img src="imgs/foot.png" class="social-img" alt="img" />
                  </a>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-12">
              <div class="footer-colomn-me">
                <h6 class="mb-5">حول الموقع</h6>
                <ul>
                  <li>
                    <a href="about-us.html">
                      <div class="my-l">من نحن</div>
                    </a>
                  </li>
                  <li>
                    <a href="contact-us.html">
                      <div class="my-l">اتصل بنا</div>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-12">
              <div class="footer-colomn-me">
                <h6 class="mb-5">الخدمات</h6>
                <ul>
                  <li>
                    <a href="about-us.html">
                      <div class="my-l">الية العمل</div>
                    </a>
                  </li>
                  <li>
                    <a href="faqs.html">
                      <div class="my-l">الاسئلة الشائعة</div>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-12">
              <div class="footer-colomn-me">
                <h6 class="mb-5">دعم ومساعدة</h6>
                <ul>
                  <a href="about-us.html" class="flex-dbl-sm mb-4">
                    <div class="d-text-footer">سياسة الاستخدام</div>
                  </a>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="down-footer dark">
        <div class="container">
          <div class="down-footer-r font14">© جميع الحقوق محفوظة © سوق</div>
          <div class="flex-footer-links">
            <a href="#">اتصل بنا</a>
            <a href="#">سياسة الخصوصية</a>
            <a href="#">الشروط والاحكام</a>
          </div>
        </div>
      </div>
    </div>
    <!--end footer-->

    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
    <script src="https://unpkg.com/wavesurfer.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/main.js"></script>

    <!-- handle abload -->
    <script>
      function handleUpload(type) {
        if (type == "image") {
          document
            .getElementById("filesNext_input")
            .setAttribute("accept", "image/*");
        } else {
          document
            .getElementById("filesNext_input")
            .setAttribute("accept", "application/*");
        }
        setTimeout(() => {
          document.getElementById("filesNext_input").click();
        });
      }
    </script>

    <script>
      $(document).ready(function () {
        $(".voice-message").each(function () {
          let item = $(this);
          const containerE = document.getElementById(
            `waveformEach${$(this).data("index")}`
          );
          if (!containerE) {
            console.error(
              `Container with id "waveform${$(this).data("index")}" not found.`
            );
            return; // Exit if the container doesn't exist
          }
          console.log(containerE);
          const waveform = WaveSurfer.create({
            container: containerE,
            waveColor: "#ddd",
            progressColor: "#4285f4",
            height: 60,
            barWidth: 2,
            responsive: true,
          });

          // Function to format time as mm:ss
          function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
          }

          // Update current time as audio plays
          waveform.on("audioprocess", function () {
            const currentTime = waveform.getCurrentTime();
            item.find(".time-main").html(formatTime(currentTime));
          });

          // Display total duration when the audio is ready
          waveform.on("ready", () => {
            var length = 300;
            var start = 0;
            var end = 300;
            // item[0].querySelector('.time-main').innerHTML = formatTime(waveform.getDuration());
            $(`#current-time${$(this).data("index")}`).text(
              formatTime(waveform.getDuration())
            );
          });

          // Update play button when audio finishes

          // Play/pause button logic
          const playPauseBtn = document.getElementById(
            `playPauseBtn${$(this).data("index")}`
          );
          waveform.on("finish", () => {
            playPauseBtn.innerHTML = playIcon;
          });
          // console.log(count);
          const playIcon = '<i class="fas fa-play"></i>';
          const pauseIcon = '<i class="fas fa-pause"></i>';

          playPauseBtn.addEventListener("click", function () {
            if (waveform.isPlaying()) {
              waveform.pause();
              this.innerHTML = playIcon;
            } else {
              waveform.play();
              this.innerHTML = pauseIcon;
            }
          });

          // Load the audio file
          // console.log(`Loading audio URL: ${audioUrl}`);

          waveform.load($(this).data("src"));
        });
      });

      // Send voice message
      let isRecording = false;
      let mediaRecorder;
      let audioChunks = [];
      let isCancelled = false;

      function startRecording() {
        navigator.mediaDevices
          .getUserMedia({ audio: true })
          .then(function (stream) {
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.start();
            isRecording = true;
            isCancelled = false;
            document.querySelector(".send-message").classList.remove("d-none");
            document.querySelector(".send-message").classList.add("d-block");
            document.querySelector(".voice-m").classList.remove("d-none");
            document.querySelector(".voice-m").classList.add("d-flex");
            document.querySelector(".voice-main").classList.add("d-none");
            document.querySelector(".voice-main").classList.remove("d-block");

            mediaRecorder.ondataavailable = function (event) {
              audioChunks.push(event.data);
            };

            mediaRecorder.onstop = function () {
              if (!isCancelled) {
                const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
                audioChunks = [];
                const audioUrl = URL.createObjectURL(audioBlob);
                console.log(audioUrl);

                sendVoiceMessage(audioUrl);
              }
              textareaWhrite();
            };
          });
      }

      function stopRecording() {
        if (mediaRecorder && isRecording) {
          mediaRecorder.stop();
          isRecording = false;
          document.querySelector(".voice-m").classList.remove("d-flex");
          document.querySelector(".voice-m").classList.add("d-none");
        }
      }

      function cancelRecording() {
        if (mediaRecorder && isRecording) {
          isCancelled = true;
          mediaRecorder.stop();
          isRecording = false;
          audioChunks = []; // Clear the recorded audio chunks

          // Hide "Cancel" button when recording is canceled
          document.querySelector(".voice-m").classList.add("d-none");
        }
        // mediaRecorder.stop();
      }

      let count = 1; // Global count variable

      function sendVoiceMessage(audioUrl) {
        console.log(count);

        // Create the message HTML
        let realMessage = `<div class="message-single mb-3 sender">
                            <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                            <div class="message-contain fit-width p-2">
                                <div class="voice-note-container">
                                    <div class="play-button" id="playPauseBtn${count}">
                                        <i class="fas fa-play"></i>
                                    </div>
                                    <div id="waveform${count}"></div>
                                    <div class="font10 gray-col" id="current-time${count}">0:00</div>
                                </div>
                                <div class="font12 message-time">${new Date().toLocaleTimeString()}</div>
                            </div>
                          </div>`;

        console.log(count);

        // Insert the message into chatArea
        chatArea.insertAdjacentHTML("beforeend", realMessage);

        // Create a new WaveSurfer instance
        const container = document.getElementById(`waveform${count}`);
        console.log(count);
        if (!container) {
          console.error(`Container with id "waveform${count}" not found.`);
          return; // Exit if the container doesn't exist
        }

        // Validate count before creating the WaveSurfer instance
        if (count < 0 || count >= 1000) {
          // Arbitrary limit for example
          console.error(`Count is out of valid range: ${count}`);
          return;
        }

        const waveform = WaveSurfer.create({
          container: container,
          waveColor: "#ddd",
          // backend: 'MediaElement',
          progressColor: "#4285f4",
          height: 60,
          barWidth: 2,
          responsive: true,
        });

        // Function to format time as mm:ss
        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);
          const secs = Math.floor(seconds % 60);
          return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
        }

        // Update current time as audio plays
        waveform.on("audioprocess", () => {
          const currentTime = waveform.getCurrentTime();
          document.getElementById(`current-time${count - 1}`).innerText =
            formatTime(currentTime);
        });

        // Display total duration when the audio is ready
        waveform.on("ready", () => {
          var length = 300;
          var start = 0;
          var end = 300;
          // console.log(waveform.backend.getPeaks(length, start, end));

          document.getElementById(`current-time${count - 1}`).innerText =
            formatTime(waveform.getDuration());
        });

        // Update play button when audio finishes

        // Play/pause button logic
        const playPauseBtn = document.getElementById(`playPauseBtn${count}`);
        waveform.on("finish", () => {
          playPauseBtn.innerHTML = playIcon;
        });
        console.log(count);
        const playIcon = '<i class="fas fa-play"></i>';
        const pauseIcon = '<i class="fas fa-pause"></i>';

        playPauseBtn.addEventListener("click", function () {
          if (waveform.isPlaying()) {
            waveform.pause();
            this.innerHTML = playIcon;
          } else {
            waveform.play();
            this.innerHTML = pauseIcon;
          }
        });

        // Load the audio file
        console.log(`Loading audio URL: ${audioUrl}`);

        waveform.load(audioUrl);

        // waveform.load(audioUrl).catch(err => {
        //     console.error('Error loading audio:', err);
        // });

        // Scroll chat area
        chatArea.scrollTop = chatArea.scrollHeight; // Update scroll to show the latest message

        count++; // Increment count after creating the message and WaveSurfer instance

        stopRecording(); // Call to stop recording function
      }

      // Voice recording button
      let recordBtn = document.querySelector(".voice-main");
      recordBtn.addEventListener("click", startRecording);
      // document.querySelector(".stop-record").addEventListener("click", stopRecording);
      document
        .querySelector(".send-message")
        .addEventListener("click", stopRecording);
      document
        .querySelector(".stop-record")
        .addEventListener("click", cancelRecording);
    </script>

    <!--chat-->
    <script>
      // send message with enter
      document
        .querySelector(".input-chat-m")
        .addEventListener("keyup", function (event) {
          if (event.keyCode === 13 && !event.shiftKey) {
            document.querySelector(".send-message").click();
            textareaWhrite();
          }
        });
      // add new line to textarea with shift + enter
      document
        .querySelector(".input-chat-m")
        .addEventListener("keyup", function (event) {
          if (event.keyCode === 13 && event.shiftKey) {
            event.preventDefault();
            document.querySelector(".input-chat-m").value += "\n";
          }
        });

      function textareaWhrite() {
        if (document.querySelector(".input-chat-m").value.trim() != "") {
          document.querySelector(".send-message").classList.remove("d-none");
          document.querySelector(".voice-main").classList.add("d-none");
          document.querySelector(".send-message").classList.add("d-flex");
          document.querySelector(".voice-main").classList.remove("d-flex");
        } else {
          document.querySelector(".send-message").classList.remove("d-flex");
          document.querySelector(".send-message").classList.add("d-none");
          document.querySelector(".voice-main").classList.remove("d-none");
          document.querySelector(".voice-main").classList.add("d-flex");
        }
      }
      let chatBtn = document.querySelector(".send-message");
      let chatInput = document.querySelector(".input-chat-m");
      let chatArea = document.querySelector(".chat-messages");
      let filesInput = document.querySelector(".files-upload-chat");
      let areaUploaded = document.querySelector(".area-uploaded");
      // send text
      function sendTextOnly() {
        let inputMessage = chatInput.value;
        let realMessage = `<div class="message-single mb-3 sender">
                                <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                                <div class="message-contain">
                                  <div class="message-text regular mb-1 font12">
                                     ${inputMessage}
                                  </div>
                                  <div class="font12  message-time">${new Date().toLocaleTimeString()} <i class="fa-solid fa-check-double color-main"></i></div>
                                </div>
                              </div>`;
        chatArea.insertAdjacentHTML("beforeend", realMessage);
        chatInput.value = "";
        chatArea.scroll(0, 5000);
        chatInput.focus();
        textareaWhrite();
        checkLenght();
      }
      // send files
      function sendFilesOnly() {
        console.log(inputsFiles.filesNext);
        for (let i = 0; i < inputsFiles.filesNext.length; i++) {
          let imgSrc = URL.createObjectURL(inputsFiles.filesNext[i]);
          if (inputsFiles.filesNext[i].type.split("/")[0] == "image") {
            let realMessage = `<div class="message-single  mb-3 sender">
                                          <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                                          <div class="message-contain fit-width">
                                            <a data-fancybox="gallery" class="mb-1" href="${imgSrc}">
                                              <img src="${imgSrc}" />
                                            </a>
                                            <div class="font12  message-time">${new Date().toLocaleTimeString()} <i class="fa-solid fa-check-double color-main"></i></div>
                                          </div>
                                        </div>`;
            chatArea.insertAdjacentHTML("beforeend", realMessage);
          } else {
            let imgName = inputsFiles.filesNext[i].name;
            let realMessage = `<div class="message-single mb-3 sender">
                                      <img src="imgs/185644495_1667380803456791_1968050560740665054_n.jpg" class="chat-user" alt="" />
                                      <div class="message-contain fit-width">
                                        <a target="_blank" class="mb-1 pdf-style" href="${imgSrc}">
                                          <span><i class="far fa-file-pdf mr-1 ml-1"></i></span>
              
                                          ${imgName}
                                        </a>
                                        <div class="font12  message-time">${new Date().toLocaleTimeString()} <i class="fa-solid fa-check-double color-main"></i></div>
                                      </div>
                                    </div>`;
            chatArea.insertAdjacentHTML("beforeend", realMessage);
          }
        }

        areaUploaded.innerHTML = "";
        filesInput.value = "";
        chatArea.scroll(0, 5000);
        chatInput.focus();
        checkLenght();
      }

      chatBtn.addEventListener("click", function () {
        if (chatInput.value.trim().length > 0 && !filesInput.value.length) {
          sendTextOnly();
        } else if (
          filesInput.value.length &&
          chatInput.value.trim().length < 1
        ) {
          sendFilesOnly();
        } else if (
          filesInput.value.length &&
          chatInput.value.trim().length > 0
        ) {
          sendTextOnly();
          sendFilesOnly();
        }
        chatArea.scroll(0, 5000);
      });
      textareaWhrite();
    </script>
    <!------------abload files------------->
    <script>
      function checkLenght() {
        if ($(".files-input").val().length) {
          document.querySelector(".send-message").classList.remove("d-none");
          document.querySelector(".voice-main").classList.add("d-none");
          document.querySelector(".send-message").classList.add("d-flex");
          document.querySelector(".voice-main").classList.remove("d-flex");
          document
            .querySelector(".input-chat-m")
            .setAttribute("disabled", true);
        } else {
          document.querySelector(".send-message").classList.remove("d-flex");
          document.querySelector(".send-message").classList.add("d-none");
          document.querySelector(".voice-main").classList.remove("d-none");
          document.querySelector(".voice-main").classList.add("d-flex");
          document.querySelector(".input-chat-m").removeAttribute("disabled");
        }
      }
      let inputsFiles = {};
      $(".files-input").on("change", function (event) {
        // check if input has value
        checkLenght();

        let input = $(this).data("input");
        const selectedFilesCont = document.getElementById(input + "_cont");
        if (!!inputsFiles[input]) {
          let files = new DataTransfer();
          for (let i = 0; i < event.target.files.length; i++) {
            files.items.add(event.target.files[i]);
          }
          for (let i = 0; i < inputsFiles[input].length; i++) {
            files.items.add(inputsFiles[input][i]);
          }
          inputsFiles[input] = files.files;
          selectedFilesCont.innerHTML = "";
        } else {
          inputsFiles[input] = event.target.files;
        }
        if (!!inputsFiles[input] && inputsFiles[input].length > 0) {
          if ($(this).data("single") == true) {
            selectedFilesCont.innerHTML = "";
            inputsFiles[input] = event.target.files;
          }
          for (let i = 0; i < inputsFiles[input].length; i++) {
            const fileType = inputsFiles[input][i].type.split("/")[0];
            if (fileType === "image") {
              let src = URL.createObjectURL(inputsFiles[input][i]);
              $("#" + input + "_cont").append(` <div class="file_">
                                                                                      <a data-fancybox="gallery" href="${src}">
                                                                                          <img src="${src}" alt="">
                                                                                      </a>
                                                                                      <div class="remove_media" onclick="deleteFile(this ,'${inputsFiles[input][i].name}' ,'${input}')"><i class="fa-solid fa-xmark font13"></i></div>
                                                                                  </div>`);
            } else if (fileType === "video") {
              let src = URL.createObjectURL(inputsFiles[input][i]);

              $("#" + input + "_cont").append(`<div class="file_">
                                                                                      <a data-fancybox="gallery" data-type="video" href="${src}">
                                                                                          <video controls>
                                                                                              <source src="${src}" type="video/mp4">
                                                                                          </video>
                                                                                          <div class="play-button"><i class="fas fa-play-circle"></i></div>
                                                                                      </a>
                                                                                      <div class="remove_media" onclick="deleteFile(this ,'${inputsFiles[input][i].name}' ,'${input}')"><i class="fa-solid fa-xmark font13"></i></div>
                                                                                  </div>`);
            } else {
              $("#" + input + "_cont").append(`<div class="file_">
                                                                                      <div class="docs_file">
                                                                                          <div class="d-flex flex-column align-items-center justify-content-center h-100 p-2">
                                                                                              <span class="font10">${inputsFiles[input][i].name}</span>
                                                                                              <span><i class="far fa-file-pdf mr-1 ml-1"></i></span>
                                                                                          </div>
                                                                                      </div>
                                                                                      <div class="remove_media" onclick="deleteFile(this ,'${inputsFiles[input][i].name}' ,'${input}')"><i class="fa-solid fa-xmark font13"></i></div>
                                                                                  </div>`);
            }
          }
        }
        event.target.files = inputsFiles[input];
      });

      function deleteFile(ele, name, input) {
        let filesInput = document.getElementById(input + "_input");
        let files = new DataTransfer();
        let deleted = null;
        for (let i = 0; i < filesInput.files.length; i++) {
          if (filesInput.files[i].name == name && deleted != name) {
            deleted = name;
            continue;
          }
          files.items.add(filesInput.files[i]);
        }
        filesInput.files = files.files;
        inputsFiles[input] = files.files;

        // edit the number of parents to delete
        $(ele).parent().remove();

        // check if input has value
        checkLenght();
      }
    </script>
  </body>
</html>
